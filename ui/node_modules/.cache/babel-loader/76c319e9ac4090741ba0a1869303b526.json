{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport fetch from \"isomorphic-unfetch\";\nimport React from \"react\";\nimport ReleaseList from \"../components/ReleaseList\";\n\nvar Home = function Home(props) {\n  return React.createElement(\"div\", {\n    className: \"jsx-2085888330\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 6\n    },\n    __self: this\n  }, React.createElement(ReleaseList, {\n    releases: props.newReleases,\n    token: props.token,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 7\n    },\n    __self: this\n  }), React.createElement(_JSXStyle, {\n    id: \"2085888330\",\n    __self: this\n  }, \"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFyb2Rkc3Nvbi9yZXBvcy9kaXNjb3ZlcmVkLmlzL3VpL3BhZ2VzL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9nQiIsImZpbGUiOiIvVXNlcnMvaXZhcm9kZHNzb24vcmVwb3MvZGlzY292ZXJlZC5pcy91aS9wYWdlcy9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmZXRjaCBmcm9tIFwiaXNvbW9ycGhpYy11bmZldGNoXCI7XG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgUmVsZWFzZUxpc3QgZnJvbSBcIi4uL2NvbXBvbmVudHMvUmVsZWFzZUxpc3RcIjtcblxuY29uc3QgSG9tZSA9IHByb3BzID0+IChcbiAgPGRpdj5cbiAgICA8UmVsZWFzZUxpc3QgcmVsZWFzZXM9e3Byb3BzLm5ld1JlbGVhc2VzfSB0b2tlbj17cHJvcHMudG9rZW59IC8+XG4gICAgPHN0eWxlIGpzeD57YGB9PC9zdHlsZT5cbiAgPC9kaXY+XG4pO1xuXG5jb25zdCBhYnNvbHV0ZVVybCA9IChyZXEsIHNldExvY2FsaG9zdCkgPT4ge1xuICBsZXQgcHJvdG9jb2wgPSBcImh0dHBzXCI7XG4gIGxldCBob3N0ID0gcmVxID8gcmVxLmhlYWRlcnMuaG9zdCA6IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTtcbiAgaWYgKGhvc3QuaW5kZXhPZihcImxvY2FsaG9zdFwiKSA+IC0xKSB7XG4gICAgaWYgKHNldExvY2FsaG9zdCkgaG9zdCA9IHNldExvY2FsaG9zdDtcbiAgICBwcm90b2NvbCA9IFwiaHR0cFwiO1xuICB9XG5cbiAgcmV0dXJuIHVybC5mb3JtYXQoe1xuICAgIHByb3RvY29sLFxuICAgIGhvc3QsXG4gICAgcGF0aG5hbWU6IFwiL1wiIC8vIHJlcS51cmxcbiAgfSk7XG59O1xuXG5Ib21lLmdldEluaXRpYWxQcm9wcyA9IGFzeW5jIGNvbnRleHQgPT4ge1xuICBjb25zdCBiYXNlVXJsID0gYWJzb2x1dGVVcmwoY29udGV4dC5yZXEsIFwibG9jYWxob3N0OjMwMDBcIik7XG4gIGNvbnN0IGFwaVVybCA9XG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiXG4gICAgICA/IGAke2Jhc2VVcmx9c2VydmVyL3JvdXRlcy9sb2dpbi5qc2BcbiAgICAgIDogXCJodHRwOi8vbG9jYWxob3N0OjQwMDAvc2VydmVyL3JvdXRlcy9sb2dpbi5qc1wiO1xuXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYXBpVXJsKTtcbiAgY29uc3QgcmVzcG9uc2VKU09OID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICBjb25zb2xlLmxvZyhyZXNwb25zZUpTT04udG9rZW4pO1xuICAvLyBHZXQgbmV3IHJlbGVhc2VzXG4gIGNvbnN0IG5ld1JlbGVhc2VzID0gYXdhaXQgZmV0Y2goXG4gICAgYGh0dHBzOi8vYXBpLnNwb3RpZnkuY29tL3YxL2Jyb3dzZS9uZXctcmVsZWFzZXM/Y291bnRyeT1TRWAsXG4gICAge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cmVzcG9uc2VKU09OLnRva2VufWAsXG4gICAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCI6IFwiKlwiLFxuICAgICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnNcIjogXCJYLVJlcXVlc3RlZC1XaXRoXCJcbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlXG4gICAgfVxuICApO1xuXG4gIC8vIENvbnZlcnQgbmV3UmVsZWFzZXMgdG8gSlNPTlxuICBjb25zdCBuZXdSZWxlYXNlc0pzb24gPSBhd2FpdCBuZXdSZWxlYXNlcy5qc29uKCk7XG5cbiAgLy8gRm9yIGVhY2ggbmV3IHJlbGVhc2UsIGdldCB0aGUgYXJ0aXN0IGFuZCBhcHBlbmQgaXQncyBnZW5yZSB0byBpdC5cbiAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgbmV3UmVsZWFzZXNKc29uLmFsYnVtcy5pdGVtcy5tYXAoYXN5bmMgaXRlbSA9PiB7XG4gICAgICAvLyBHZXQgYXJ0aXN0IGJ5IElEXG4gICAgICBjb25zdCBhcnRpc3RCeUlkID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGBodHRwczovL2FwaS5zcG90aWZ5LmNvbS92MS9hcnRpc3RzLyR7aXRlbS5hcnRpc3RzWzBdLmlkfWAsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cmVzcG9uc2VKU09OLnRva2VufWAsXG4gICAgICAgICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiOiBcIipcIixcbiAgICAgICAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyc1wiOiBcIlgtUmVxdWVzdGVkLVdpdGhcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICAvLyBDb252ZXJ0IGFydGlzdCB0byBKU09OXG4gICAgICBjb25zdCBhcnRpc3RCeUlkSlNPTiA9IGF3YWl0IGFydGlzdEJ5SWQuanNvbigpO1xuICAgICAgaXRlbS5nZW5yZXMgPSBhcnRpc3RCeUlkSlNPTi5nZW5yZXM7XG4gICAgICByZXR1cm4gaXRlbTtcbiAgICB9KVxuICApO1xuXG4gIHJldHVybiB7XG4gICAgbmV3UmVsZWFzZXM6IG5ld1JlbGVhc2VzSnNvblxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgSG9tZTtcbiJdfQ== */\\n/*@ sourceURL=/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js */\"));\n};\n\nvar absoluteUrl = function absoluteUrl(req, setLocalhost) {\n  var protocol = \"https\";\n  var host = req ? req.headers.host : window.location.hostname;\n\n  if (host.indexOf(\"localhost\") > -1) {\n    if (setLocalhost) host = setLocalhost;\n    protocol = \"http\";\n  }\n\n  return url.format({\n    protocol: protocol,\n    host: host,\n    pathname: \"/\" // req.url\n\n  });\n};\n\nHome.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(context) {\n    var baseUrl, apiUrl, response, responseJSON, newReleases, newReleasesJson;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            baseUrl = absoluteUrl(context.req, \"localhost:3000\");\n            apiUrl = process.env.NODE_ENV === \"production\" ? \"\".concat(baseUrl, \"server/routes/login.js\") : \"http://localhost:4000/server/routes/login.js\";\n            _context2.next = 4;\n            return fetch(apiUrl);\n\n          case 4:\n            response = _context2.sent;\n            _context2.next = 7;\n            return response.json();\n\n          case 7:\n            responseJSON = _context2.sent;\n            console.log(responseJSON.token); // Get new releases\n\n            _context2.next = 11;\n            return fetch(\"https://api.spotify.com/v1/browse/new-releases?country=SE\", {\n              headers: {\n                Authorization: \"Bearer \".concat(responseJSON.token),\n                \"Access-Control-Allow-Origin\": \"*\",\n                \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n              },\n              json: true\n            });\n\n          case 11:\n            newReleases = _context2.sent;\n            _context2.next = 14;\n            return newReleases.json();\n\n          case 14:\n            newReleasesJson = _context2.sent;\n            _context2.next = 17;\n            return _Promise.all(newReleasesJson.albums.items.map(\n            /*#__PURE__*/\n            function () {\n              var _ref2 = _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee(item) {\n                var artistById, artistByIdJSON;\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.next = 2;\n                        return fetch(\"https://api.spotify.com/v1/artists/\".concat(item.artists[0].id), {\n                          headers: {\n                            Authorization: \"Bearer \".concat(responseJSON.token),\n                            \"Access-Control-Allow-Origin\": \"*\",\n                            \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n                          },\n                          json: true\n                        });\n\n                      case 2:\n                        artistById = _context.sent;\n                        _context.next = 5;\n                        return artistById.json();\n\n                      case 5:\n                        artistByIdJSON = _context.sent;\n                        item.genres = artistByIdJSON.genres;\n                        return _context.abrupt(\"return\", item);\n\n                      case 8:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function (_x2) {\n                return _ref2.apply(this, arguments);\n              };\n            }()));\n\n          case 17:\n            return _context2.abrupt(\"return\", {\n              newReleases: newReleasesJson\n            });\n\n          case 18:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexport default Home;","map":{"version":3,"sources":["/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js"],"names":["fetch","React","ReleaseList","Home","props","newReleases","token","absoluteUrl","req","setLocalhost","protocol","host","headers","window","location","hostname","indexOf","url","format","pathname","getInitialProps","context","baseUrl","apiUrl","process","env","NODE_ENV","response","json","responseJSON","console","log","Authorization","newReleasesJson","all","albums","items","map","item","artists","id","artistById","artistByIdJSON","genres"],"mappings":"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","sourcesContent":["import fetch from \"isomorphic-unfetch\";\nimport React from \"react\";\nimport ReleaseList from \"../components/ReleaseList\";\n\nconst Home = props => (\n  <div>\n    <ReleaseList releases={props.newReleases} token={props.token} />\n    <style jsx>{``}</style>\n  </div>\n);\n\nconst absoluteUrl = (req, setLocalhost) => {\n  let protocol = \"https\";\n  let host = req ? req.headers.host : window.location.hostname;\n  if (host.indexOf(\"localhost\") > -1) {\n    if (setLocalhost) host = setLocalhost;\n    protocol = \"http\";\n  }\n\n  return url.format({\n    protocol,\n    host,\n    pathname: \"/\" // req.url\n  });\n};\n\nHome.getInitialProps = async context => {\n  const baseUrl = absoluteUrl(context.req, \"localhost:3000\");\n  const apiUrl =\n    process.env.NODE_ENV === \"production\"\n      ? `${baseUrl}server/routes/login.js`\n      : \"http://localhost:4000/server/routes/login.js\";\n\n  const response = await fetch(apiUrl);\n  const responseJSON = await response.json();\n  console.log(responseJSON.token);\n  // Get new releases\n  const newReleases = await fetch(\n    `https://api.spotify.com/v1/browse/new-releases?country=SE`,\n    {\n      headers: {\n        Authorization: `Bearer ${responseJSON.token}`,\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n      },\n      json: true\n    }\n  );\n\n  // Convert newReleases to JSON\n  const newReleasesJson = await newReleases.json();\n\n  // For each new release, get the artist and append it's genre to it.\n  await Promise.all(\n    newReleasesJson.albums.items.map(async item => {\n      // Get artist by ID\n      const artistById = await fetch(\n        `https://api.spotify.com/v1/artists/${item.artists[0].id}`,\n        {\n          headers: {\n            Authorization: `Bearer ${responseJSON.token}`,\n            \"Access-Control-Allow-Origin\": \"*\",\n            \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n          },\n          json: true\n        }\n      );\n\n      // Convert artist to JSON\n      const artistByIdJSON = await artistById.json();\n      item.genres = artistByIdJSON.genres;\n      return item;\n    })\n  );\n\n  return {\n    newReleases: newReleasesJson\n  };\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}