{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport fetch from \"isomorphic-unfetch\";\nimport React from \"react\";\nimport url from \"url\";\nimport ReleaseList from \"../components/ReleaseList\";\n\nvar Home = function Home(props) {\n  return React.createElement(\"div\", {\n    className: \"jsx-2085888330\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 7\n    },\n    __self: this\n  }, React.createElement(ReleaseList, {\n    releases: props.newReleases,\n    token: props.token,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 8\n    },\n    __self: this\n  }), React.createElement(_JSXStyle, {\n    id: \"2085888330\",\n    __self: this\n  }, \"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFyb2Rkc3Nvbi9yZXBvcy9kaXNjb3ZlcmVkLmlzL3VpL3BhZ2VzL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVFnQiIsImZpbGUiOiIvVXNlcnMvaXZhcm9kZHNzb24vcmVwb3MvZGlzY292ZXJlZC5pcy91aS9wYWdlcy9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmZXRjaCBmcm9tIFwiaXNvbW9ycGhpYy11bmZldGNoXCI7XG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgdXJsIGZyb20gXCJ1cmxcIjtcbmltcG9ydCBSZWxlYXNlTGlzdCBmcm9tIFwiLi4vY29tcG9uZW50cy9SZWxlYXNlTGlzdFwiO1xuXG5jb25zdCBIb21lID0gcHJvcHMgPT4gKFxuICA8ZGl2PlxuICAgIDxSZWxlYXNlTGlzdCByZWxlYXNlcz17cHJvcHMubmV3UmVsZWFzZXN9IHRva2VuPXtwcm9wcy50b2tlbn0gLz5cbiAgICA8c3R5bGUganN4PntgYH08L3N0eWxlPlxuICA8L2Rpdj5cbik7XG5cbmNvbnN0IGFic29sdXRlVXJsID0gKHJlcSwgc2V0TG9jYWxob3N0KSA9PiB7XG4gIGxldCBwcm90b2NvbCA9IFwiaHR0cHNcIjtcbiAgbGV0IGhvc3QgPSByZXEgPyByZXEuaGVhZGVycy5ob3N0IDogd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lO1xuICBpZiAoaG9zdC5pbmRleE9mKFwibG9jYWxob3N0XCIpID4gLTEpIHtcbiAgICBpZiAoc2V0TG9jYWxob3N0KSBob3N0ID0gc2V0TG9jYWxob3N0O1xuICAgIHByb3RvY29sID0gXCJodHRwXCI7XG4gIH1cblxuICByZXR1cm4gdXJsLmZvcm1hdCh7XG4gICAgcHJvdG9jb2wsXG4gICAgaG9zdCxcbiAgICBwYXRobmFtZTogXCIvXCIgLy8gcmVxLnVybFxuICB9KTtcbn07XG5cbkhvbWUuZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMgY29udGV4dCA9PiB7XG4gIGNvbnN0IGJhc2VVcmwgPSBhYnNvbHV0ZVVybChjb250ZXh0LnJlcSwgXCJsb2NhbGhvc3Q6MzAwMFwiKTtcbiAgY29uc3QgYXBpVXJsID1cbiAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCJcbiAgICAgID8gYCR7YmFzZVVybH1zZXJ2ZXIvcm91dGVzL2xvZ2luLmpzYFxuICAgICAgOiBcImh0dHA6Ly9sb2NhbGhvc3Q6NDAwMC9zZXJ2ZXIvcm91dGVzL2xvZ2luLmpzXCI7XG5cbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChhcGlVcmwpO1xuICBjb25zdCByZXNwb25zZUpTT04gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gIGNvbnNvbGUubG9nKHJlc3BvbnNlSlNPTi50b2tlbik7XG4gIC8vIEdldCBuZXcgcmVsZWFzZXNcbiAgY29uc3QgbmV3UmVsZWFzZXMgPSBhd2FpdCBmZXRjaChcbiAgICBgaHR0cHM6Ly9hcGkuc3BvdGlmeS5jb20vdjEvYnJvd3NlL25ldy1yZWxlYXNlcz9jb3VudHJ5PVNFYCxcbiAgICB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtyZXNwb25zZUpTT04udG9rZW59YCxcbiAgICAgICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW5cIjogXCIqXCIsXG4gICAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyc1wiOiBcIlgtUmVxdWVzdGVkLVdpdGhcIlxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9XG4gICk7XG5cbiAgLy8gQ29udmVydCBuZXdSZWxlYXNlcyB0byBKU09OXG4gIGNvbnN0IG5ld1JlbGVhc2VzSnNvbiA9IGF3YWl0IG5ld1JlbGVhc2VzLmpzb24oKTtcblxuICAvLyBGb3IgZWFjaCBuZXcgcmVsZWFzZSwgZ2V0IHRoZSBhcnRpc3QgYW5kIGFwcGVuZCBpdCdzIGdlbnJlIHRvIGl0LlxuICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICBuZXdSZWxlYXNlc0pzb24uYWxidW1zICYmXG4gICAgICBuZXdSZWxlYXNlc0pzb24uYWxidW1zLml0ZW1zLm1hcChhc3luYyBpdGVtID0+IHtcbiAgICAgICAgLy8gR2V0IGFydGlzdCBieSBJRFxuICAgICAgICBjb25zdCBhcnRpc3RCeUlkID0gYXdhaXQgZmV0Y2goXG4gICAgICAgICAgYGh0dHBzOi8vYXBpLnNwb3RpZnkuY29tL3YxL2FydGlzdHMvJHtpdGVtLmFydGlzdHNbMF0uaWR9YCxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtyZXNwb25zZUpTT04udG9rZW59YCxcbiAgICAgICAgICAgICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW5cIjogXCIqXCIsXG4gICAgICAgICAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyc1wiOiBcIlgtUmVxdWVzdGVkLVdpdGhcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGpzb246IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQ29udmVydCBhcnRpc3QgdG8gSlNPTlxuICAgICAgICBjb25zdCBhcnRpc3RCeUlkSlNPTiA9IGF3YWl0IGFydGlzdEJ5SWQuanNvbigpO1xuICAgICAgICBpdGVtLmdlbnJlcyA9IGFydGlzdEJ5SWRKU09OLmdlbnJlcztcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICB9KVxuICApO1xuXG4gIHJldHVybiB7XG4gICAgbmV3UmVsZWFzZXM6IG5ld1JlbGVhc2VzSnNvblxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgSG9tZTtcbiJdfQ== */\\n/*@ sourceURL=/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js */\"));\n};\n\nvar absoluteUrl = function absoluteUrl(req, setLocalhost) {\n  var protocol = \"https\";\n  var host = req ? req.headers.host : window.location.hostname;\n\n  if (host.indexOf(\"localhost\") > -1) {\n    if (setLocalhost) host = setLocalhost;\n    protocol = \"http\";\n  }\n\n  return url.format({\n    protocol: protocol,\n    host: host,\n    pathname: \"/\" // req.url\n\n  });\n};\n\nHome.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(context) {\n    var baseUrl, apiUrl, response, responseJSON, newReleases, newReleasesJson;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            baseUrl = absoluteUrl(context.req, \"localhost:3000\");\n            apiUrl = process.env.NODE_ENV === \"production\" ? \"\".concat(baseUrl, \"server/routes/login.js\") : \"http://localhost:4000/server/routes/login.js\";\n            _context2.next = 4;\n            return fetch(apiUrl);\n\n          case 4:\n            response = _context2.sent;\n            _context2.next = 7;\n            return response.json();\n\n          case 7:\n            responseJSON = _context2.sent;\n            console.log(responseJSON.token); // Get new releases\n\n            _context2.next = 11;\n            return fetch(\"https://api.spotify.com/v1/browse/new-releases?country=SE\", {\n              headers: {\n                Authorization: \"Bearer \".concat(responseJSON.token),\n                \"Access-Control-Allow-Origin\": \"*\",\n                \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n              },\n              json: true\n            });\n\n          case 11:\n            newReleases = _context2.sent;\n            _context2.next = 14;\n            return newReleases.json();\n\n          case 14:\n            newReleasesJson = _context2.sent;\n            _context2.next = 17;\n            return _Promise.all(newReleasesJson.albums && newReleasesJson.albums.items.map(\n            /*#__PURE__*/\n            function () {\n              var _ref2 = _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee(item) {\n                var artistById, artistByIdJSON;\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.next = 2;\n                        return fetch(\"https://api.spotify.com/v1/artists/\".concat(item.artists[0].id), {\n                          headers: {\n                            Authorization: \"Bearer \".concat(responseJSON.token),\n                            \"Access-Control-Allow-Origin\": \"*\",\n                            \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n                          },\n                          json: true\n                        });\n\n                      case 2:\n                        artistById = _context.sent;\n                        _context.next = 5;\n                        return artistById.json();\n\n                      case 5:\n                        artistByIdJSON = _context.sent;\n                        item.genres = artistByIdJSON.genres;\n                        return _context.abrupt(\"return\", item);\n\n                      case 8:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function (_x2) {\n                return _ref2.apply(this, arguments);\n              };\n            }()));\n\n          case 17:\n            return _context2.abrupt(\"return\", {\n              newReleases: newReleasesJson\n            });\n\n          case 18:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexport default Home;","map":{"version":3,"sources":["/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js"],"names":["fetch","React","url","ReleaseList","Home","props","newReleases","token","absoluteUrl","req","setLocalhost","protocol","host","headers","window","location","hostname","indexOf","format","pathname","getInitialProps","context","baseUrl","apiUrl","process","env","NODE_ENV","response","json","responseJSON","console","log","Authorization","newReleasesJson","all","albums","items","map","item","artists","id","artistById","artistByIdJSON","genres"],"mappings":"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","sourcesContent":["import fetch from \"isomorphic-unfetch\";\nimport React from \"react\";\nimport url from \"url\";\nimport ReleaseList from \"../components/ReleaseList\";\n\nconst Home = props => (\n  <div>\n    <ReleaseList releases={props.newReleases} token={props.token} />\n    <style jsx>{``}</style>\n  </div>\n);\n\nconst absoluteUrl = (req, setLocalhost) => {\n  let protocol = \"https\";\n  let host = req ? req.headers.host : window.location.hostname;\n  if (host.indexOf(\"localhost\") > -1) {\n    if (setLocalhost) host = setLocalhost;\n    protocol = \"http\";\n  }\n\n  return url.format({\n    protocol,\n    host,\n    pathname: \"/\" // req.url\n  });\n};\n\nHome.getInitialProps = async context => {\n  const baseUrl = absoluteUrl(context.req, \"localhost:3000\");\n  const apiUrl =\n    process.env.NODE_ENV === \"production\"\n      ? `${baseUrl}server/routes/login.js`\n      : \"http://localhost:4000/server/routes/login.js\";\n\n  const response = await fetch(apiUrl);\n  const responseJSON = await response.json();\n  console.log(responseJSON.token);\n  // Get new releases\n  const newReleases = await fetch(\n    `https://api.spotify.com/v1/browse/new-releases?country=SE`,\n    {\n      headers: {\n        Authorization: `Bearer ${responseJSON.token}`,\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n      },\n      json: true\n    }\n  );\n\n  // Convert newReleases to JSON\n  const newReleasesJson = await newReleases.json();\n\n  // For each new release, get the artist and append it's genre to it.\n  await Promise.all(\n    newReleasesJson.albums &&\n      newReleasesJson.albums.items.map(async item => {\n        // Get artist by ID\n        const artistById = await fetch(\n          `https://api.spotify.com/v1/artists/${item.artists[0].id}`,\n          {\n            headers: {\n              Authorization: `Bearer ${responseJSON.token}`,\n              \"Access-Control-Allow-Origin\": \"*\",\n              \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n            },\n            json: true\n          }\n        );\n\n        // Convert artist to JSON\n        const artistByIdJSON = await artistById.json();\n        item.genres = artistByIdJSON.genres;\n        return item;\n      })\n  );\n\n  return {\n    newReleases: newReleasesJson\n  };\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}