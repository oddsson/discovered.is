{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport fetch from \"isomorphic-unfetch\";\nimport React from \"react\";\nimport ReleaseList from \"../components/ReleaseList\";\n\nvar Home = function Home(props) {\n  return React.createElement(\"div\", {\n    className: \"jsx-2085888330\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 6\n    },\n    __self: this\n  }, React.createElement(ReleaseList, {\n    releases: props.newReleases,\n    token: props.token,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 7\n    },\n    __self: this\n  }), React.createElement(_JSXStyle, {\n    id: \"2085888330\",\n    __self: this\n  }, \"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFyb2Rkc3Nvbi9yZXBvcy9kaXNjb3ZlcmVkLmlzL3VpL3BhZ2VzL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9nQiIsImZpbGUiOiIvVXNlcnMvaXZhcm9kZHNzb24vcmVwb3MvZGlzY292ZXJlZC5pcy91aS9wYWdlcy9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmZXRjaCBmcm9tIFwiaXNvbW9ycGhpYy11bmZldGNoXCI7XG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgUmVsZWFzZUxpc3QgZnJvbSBcIi4uL2NvbXBvbmVudHMvUmVsZWFzZUxpc3RcIjtcblxuY29uc3QgSG9tZSA9IHByb3BzID0+IChcbiAgPGRpdj5cbiAgICA8UmVsZWFzZUxpc3QgcmVsZWFzZXM9e3Byb3BzLm5ld1JlbGVhc2VzfSB0b2tlbj17cHJvcHMudG9rZW59IC8+XG4gICAgPHN0eWxlIGpzeD57YGB9PC9zdHlsZT5cbiAgPC9kaXY+XG4pO1xuXG5jb25zdCBhYnNvbHV0ZVVybCA9IChyZXEsIHNldExvY2FsaG9zdCkgPT4ge1xuICBsZXQgcHJvdG9jb2wgPSBcImh0dHBzXCI7XG4gIGxldCBob3N0ID0gcmVxID8gcmVxLmhlYWRlcnMuaG9zdCA6IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTtcbiAgaWYgKGhvc3QuaW5kZXhPZihcImxvY2FsaG9zdFwiKSA+IC0xKSB7XG4gICAgaWYgKHNldExvY2FsaG9zdCkgaG9zdCA9IHNldExvY2FsaG9zdDtcbiAgICBwcm90b2NvbCA9IFwiaHR0cFwiO1xuICB9XG5cbiAgcmV0dXJuIHVybC5mb3JtYXQoe1xuICAgIHByb3RvY29sLFxuICAgIGhvc3QsXG4gICAgcGF0aG5hbWU6IFwiL1wiIC8vIHJlcS51cmxcbiAgfSk7XG59O1xuXG5Ib21lLmdldEluaXRpYWxQcm9wcyA9IGFzeW5jICh7IHJlcSwgcmVzIH0pID0+IHtcbiAgY29uc3QgYmFzZVVybCA9IGFic29sdXRlVXJsKGNvbnRleHQucmVxLCBcImxvY2FsaG9zdDozMDAwXCIpO1xuICBjb25zdCBhcGlVcmwgPVxuICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIlxuICAgICAgPyBgJHtiYXNlVXJsfXNlcnZlci9yb3V0ZXMvbG9naW4uanNgXG4gICAgICA6IFwiaHR0cDovL2xvY2FsaG9zdDo0MDAwL3NlcnZlci9yb3V0ZXMvbG9naW4uanNcIjtcblxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGFwaVVybCk7XG4gIGNvbnN0IHJlc3BvbnNlSlNPTiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgY29uc29sZS5sb2cocmVzcG9uc2VKU09OLnRva2VuKTtcbiAgLy8gR2V0IG5ldyByZWxlYXNlc1xuICBjb25zdCBuZXdSZWxlYXNlcyA9IGF3YWl0IGZldGNoKFxuICAgIGBodHRwczovL2FwaS5zcG90aWZ5LmNvbS92MS9icm93c2UvbmV3LXJlbGVhc2VzP2NvdW50cnk9U0VgLFxuICAgIHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Jlc3BvbnNlSlNPTi50b2tlbn1gLFxuICAgICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiOiBcIipcIixcbiAgICAgICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzXCI6IFwiWC1SZXF1ZXN0ZWQtV2l0aFwiXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH1cbiAgKTtcblxuICAvLyBDb252ZXJ0IG5ld1JlbGVhc2VzIHRvIEpTT05cbiAgY29uc3QgbmV3UmVsZWFzZXNKc29uID0gYXdhaXQgbmV3UmVsZWFzZXMuanNvbigpO1xuXG4gIC8vIEZvciBlYWNoIG5ldyByZWxlYXNlLCBnZXQgdGhlIGFydGlzdCBhbmQgYXBwZW5kIGl0J3MgZ2VucmUgdG8gaXQuXG4gIGF3YWl0IFByb21pc2UuYWxsKFxuICAgIG5ld1JlbGVhc2VzSnNvbi5hbGJ1bXMuaXRlbXMubWFwKGFzeW5jIGl0ZW0gPT4ge1xuICAgICAgLy8gR2V0IGFydGlzdCBieSBJRFxuICAgICAgY29uc3QgYXJ0aXN0QnlJZCA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgaHR0cHM6Ly9hcGkuc3BvdGlmeS5jb20vdjEvYXJ0aXN0cy8ke2l0ZW0uYXJ0aXN0c1swXS5pZH1gLFxuICAgICAgICB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Jlc3BvbnNlSlNPTi50b2tlbn1gLFxuICAgICAgICAgICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW5cIjogXCIqXCIsXG4gICAgICAgICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnNcIjogXCJYLVJlcXVlc3RlZC1XaXRoXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIGpzb246IHRydWVcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgLy8gQ29udmVydCBhcnRpc3QgdG8gSlNPTlxuICAgICAgY29uc3QgYXJ0aXN0QnlJZEpTT04gPSBhd2FpdCBhcnRpc3RCeUlkLmpzb24oKTtcbiAgICAgIGl0ZW0uZ2VucmVzID0gYXJ0aXN0QnlJZEpTT04uZ2VucmVzO1xuICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfSlcbiAgKTtcblxuICByZXR1cm4ge1xuICAgIG5ld1JlbGVhc2VzOiBuZXdSZWxlYXNlc0pzb25cbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEhvbWU7XG4iXX0= */\\n/*@ sourceURL=/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js */\"));\n};\n\nvar absoluteUrl = function absoluteUrl(req, setLocalhost) {\n  var protocol = \"https\";\n  var host = req ? req.headers.host : window.location.hostname;\n\n  if (host.indexOf(\"localhost\") > -1) {\n    if (setLocalhost) host = setLocalhost;\n    protocol = \"http\";\n  }\n\n  return url.format({\n    protocol: protocol,\n    host: host,\n    pathname: \"/\" // req.url\n\n  });\n};\n\nHome.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(_ref) {\n    var req, res, baseUrl, apiUrl, response, responseJSON, newReleases, newReleasesJson;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            req = _ref.req, res = _ref.res;\n            baseUrl = absoluteUrl(context.req, \"localhost:3000\");\n            apiUrl = process.env.NODE_ENV === \"production\" ? \"\".concat(baseUrl, \"server/routes/login.js\") : \"http://localhost:4000/server/routes/login.js\";\n            _context2.next = 5;\n            return fetch(apiUrl);\n\n          case 5:\n            response = _context2.sent;\n            _context2.next = 8;\n            return response.json();\n\n          case 8:\n            responseJSON = _context2.sent;\n            console.log(responseJSON.token); // Get new releases\n\n            _context2.next = 12;\n            return fetch(\"https://api.spotify.com/v1/browse/new-releases?country=SE\", {\n              headers: {\n                Authorization: \"Bearer \".concat(responseJSON.token),\n                \"Access-Control-Allow-Origin\": \"*\",\n                \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n              },\n              json: true\n            });\n\n          case 12:\n            newReleases = _context2.sent;\n            _context2.next = 15;\n            return newReleases.json();\n\n          case 15:\n            newReleasesJson = _context2.sent;\n            _context2.next = 18;\n            return _Promise.all(newReleasesJson.albums.items.map(\n            /*#__PURE__*/\n            function () {\n              var _ref3 = _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee(item) {\n                var artistById, artistByIdJSON;\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.next = 2;\n                        return fetch(\"https://api.spotify.com/v1/artists/\".concat(item.artists[0].id), {\n                          headers: {\n                            Authorization: \"Bearer \".concat(responseJSON.token),\n                            \"Access-Control-Allow-Origin\": \"*\",\n                            \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n                          },\n                          json: true\n                        });\n\n                      case 2:\n                        artistById = _context.sent;\n                        _context.next = 5;\n                        return artistById.json();\n\n                      case 5:\n                        artistByIdJSON = _context.sent;\n                        item.genres = artistByIdJSON.genres;\n                        return _context.abrupt(\"return\", item);\n\n                      case 8:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function (_x2) {\n                return _ref3.apply(this, arguments);\n              };\n            }()));\n\n          case 18:\n            return _context2.abrupt(\"return\", {\n              newReleases: newReleasesJson\n            });\n\n          case 19:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default Home;","map":{"version":3,"sources":["/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js"],"names":["fetch","React","ReleaseList","Home","props","newReleases","token","absoluteUrl","req","setLocalhost","protocol","host","headers","window","location","hostname","indexOf","url","format","pathname","getInitialProps","res","baseUrl","context","apiUrl","process","env","NODE_ENV","response","json","responseJSON","console","log","Authorization","newReleasesJson","all","albums","items","map","item","artists","id","artistById","artistByIdJSON","genres"],"mappings":"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","sourcesContent":["import fetch from \"isomorphic-unfetch\";\nimport React from \"react\";\nimport ReleaseList from \"../components/ReleaseList\";\n\nconst Home = props => (\n  <div>\n    <ReleaseList releases={props.newReleases} token={props.token} />\n    <style jsx>{``}</style>\n  </div>\n);\n\nconst absoluteUrl = (req, setLocalhost) => {\n  let protocol = \"https\";\n  let host = req ? req.headers.host : window.location.hostname;\n  if (host.indexOf(\"localhost\") > -1) {\n    if (setLocalhost) host = setLocalhost;\n    protocol = \"http\";\n  }\n\n  return url.format({\n    protocol,\n    host,\n    pathname: \"/\" // req.url\n  });\n};\n\nHome.getInitialProps = async ({ req, res }) => {\n  const baseUrl = absoluteUrl(context.req, \"localhost:3000\");\n  const apiUrl =\n    process.env.NODE_ENV === \"production\"\n      ? `${baseUrl}server/routes/login.js`\n      : \"http://localhost:4000/server/routes/login.js\";\n\n  const response = await fetch(apiUrl);\n  const responseJSON = await response.json();\n  console.log(responseJSON.token);\n  // Get new releases\n  const newReleases = await fetch(\n    `https://api.spotify.com/v1/browse/new-releases?country=SE`,\n    {\n      headers: {\n        Authorization: `Bearer ${responseJSON.token}`,\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n      },\n      json: true\n    }\n  );\n\n  // Convert newReleases to JSON\n  const newReleasesJson = await newReleases.json();\n\n  // For each new release, get the artist and append it's genre to it.\n  await Promise.all(\n    newReleasesJson.albums.items.map(async item => {\n      // Get artist by ID\n      const artistById = await fetch(\n        `https://api.spotify.com/v1/artists/${item.artists[0].id}`,\n        {\n          headers: {\n            Authorization: `Bearer ${responseJSON.token}`,\n            \"Access-Control-Allow-Origin\": \"*\",\n            \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n          },\n          json: true\n        }\n      );\n\n      // Convert artist to JSON\n      const artistByIdJSON = await artistById.json();\n      item.genres = artistByIdJSON.genres;\n      return item;\n    })\n  );\n\n  return {\n    newReleases: newReleasesJson\n  };\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}