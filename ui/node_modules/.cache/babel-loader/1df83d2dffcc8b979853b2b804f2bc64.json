{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport fetch from \"isomorphic-unfetch\";\nimport React from \"react\";\nimport ReleaseList from \"../components/ReleaseList\";\n\nvar Home = function Home(props) {\n  return React.createElement(\"div\", {\n    className: \"jsx-2085888330\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 6\n    },\n    __self: this\n  }, React.createElement(ReleaseList, {\n    releases: props.newReleases,\n    token: props.token,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 7\n    },\n    __self: this\n  }), React.createElement(_JSXStyle, {\n    id: \"2085888330\",\n    __self: this\n  }, \"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFyb2Rkc3Nvbi9yZXBvcy9kaXNjb3ZlcmVkLmlzL3VpL3BhZ2VzL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9nQiIsImZpbGUiOiIvVXNlcnMvaXZhcm9kZHNzb24vcmVwb3MvZGlzY292ZXJlZC5pcy91aS9wYWdlcy9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmZXRjaCBmcm9tIFwiaXNvbW9ycGhpYy11bmZldGNoXCI7XG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgUmVsZWFzZUxpc3QgZnJvbSBcIi4uL2NvbXBvbmVudHMvUmVsZWFzZUxpc3RcIjtcblxuY29uc3QgSG9tZSA9IHByb3BzID0+IChcbiAgPGRpdj5cbiAgICA8UmVsZWFzZUxpc3QgcmVsZWFzZXM9e3Byb3BzLm5ld1JlbGVhc2VzfSB0b2tlbj17cHJvcHMudG9rZW59IC8+XG4gICAgPHN0eWxlIGpzeD57YGB9PC9zdHlsZT5cbiAgPC9kaXY+XG4pO1xuXG5Ib21lLmdldEluaXRpYWxQcm9wcyA9IGFzeW5jICh7IHJlcSwgcmVzIH0pID0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDo0MDAwL3NlcnZlci9yb3V0ZXMvbG9naW4uanNgKTtcbiAgY29uc3QgcmVzcG9uc2VKU09OID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICBjb25zb2xlLmxvZyhyZXNwb25zZUpTT04udG9rZW4pO1xuICAvLyBHZXQgbmV3IHJlbGVhc2VzXG4gIGNvbnN0IG5ld1JlbGVhc2VzID0gYXdhaXQgZmV0Y2goXG4gICAgYGh0dHBzOi8vYXBpLnNwb3RpZnkuY29tL3YxL2Jyb3dzZS9uZXctcmVsZWFzZXM/Y291bnRyeT1TRWAsXG4gICAge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cmVzcG9uc2VKU09OLnRva2VufWAsXG4gICAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCI6IFwiKlwiLFxuICAgICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnNcIjogXCJYLVJlcXVlc3RlZC1XaXRoXCJcbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlXG4gICAgfVxuICApO1xuXG4gIC8vIENvbnZlcnQgbmV3UmVsZWFzZXMgdG8gSlNPTlxuICBjb25zdCBuZXdSZWxlYXNlc0pzb24gPSBhd2FpdCBuZXdSZWxlYXNlcy5qc29uKCk7XG5cbiAgLy8gRm9yIGVhY2ggbmV3IHJlbGVhc2UsIGdldCB0aGUgYXJ0aXN0IGFuZCBhcHBlbmQgaXQncyBnZW5yZSB0byBpdC5cbiAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgbmV3UmVsZWFzZXNKc29uLmFsYnVtcy5pdGVtcy5tYXAoYXN5bmMgaXRlbSA9PiB7XG4gICAgICAvLyBHZXQgYXJ0aXN0IGJ5IElEXG4gICAgICBjb25zdCBhcnRpc3RCeUlkID0gYXdhaXQgZmV0Y2goXG4gICAgICAgIGBodHRwczovL2FwaS5zcG90aWZ5LmNvbS92MS9hcnRpc3RzLyR7aXRlbS5hcnRpc3RzWzBdLmlkfWAsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cmVzcG9uc2VKU09OLnRva2VufWAsXG4gICAgICAgICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiOiBcIipcIixcbiAgICAgICAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyc1wiOiBcIlgtUmVxdWVzdGVkLVdpdGhcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAganNvbjogdHJ1ZVxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICAvLyBDb252ZXJ0IGFydGlzdCB0byBKU09OXG4gICAgICBjb25zdCBhcnRpc3RCeUlkSlNPTiA9IGF3YWl0IGFydGlzdEJ5SWQuanNvbigpO1xuICAgICAgaXRlbS5nZW5yZXMgPSBhcnRpc3RCeUlkSlNPTi5nZW5yZXM7XG4gICAgICByZXR1cm4gaXRlbTtcbiAgICB9KVxuICApO1xuXG4gIHJldHVybiB7XG4gICAgbmV3UmVsZWFzZXM6IG5ld1JlbGVhc2VzSnNvblxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgSG9tZTtcbiJdfQ== */\\n/*@ sourceURL=/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js */\"));\n};\n\nHome.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(_ref) {\n    var req, res, response, responseJSON, newReleases, newReleasesJson;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            req = _ref.req, res = _ref.res;\n            _context2.next = 3;\n            return fetch(\"http://localhost:4000/server/routes/login.js\");\n\n          case 3:\n            response = _context2.sent;\n            _context2.next = 6;\n            return response.json();\n\n          case 6:\n            responseJSON = _context2.sent;\n            console.log(responseJSON.token); // Get new releases\n\n            _context2.next = 10;\n            return fetch(\"https://api.spotify.com/v1/browse/new-releases?country=SE\", {\n              headers: {\n                Authorization: \"Bearer \".concat(responseJSON.token),\n                \"Access-Control-Allow-Origin\": \"*\",\n                \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n              },\n              json: true\n            });\n\n          case 10:\n            newReleases = _context2.sent;\n            _context2.next = 13;\n            return newReleases.json();\n\n          case 13:\n            newReleasesJson = _context2.sent;\n            _context2.next = 16;\n            return _Promise.all(newReleasesJson.albums.items.map(\n            /*#__PURE__*/\n            function () {\n              var _ref3 = _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee(item) {\n                var artistById, artistByIdJSON;\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.next = 2;\n                        return fetch(\"https://api.spotify.com/v1/artists/\".concat(item.artists[0].id), {\n                          headers: {\n                            Authorization: \"Bearer \".concat(responseJSON.token),\n                            \"Access-Control-Allow-Origin\": \"*\",\n                            \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n                          },\n                          json: true\n                        });\n\n                      case 2:\n                        artistById = _context.sent;\n                        _context.next = 5;\n                        return artistById.json();\n\n                      case 5:\n                        artistByIdJSON = _context.sent;\n                        item.genres = artistByIdJSON.genres;\n                        return _context.abrupt(\"return\", item);\n\n                      case 8:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function (_x2) {\n                return _ref3.apply(this, arguments);\n              };\n            }()));\n\n          case 16:\n            return _context2.abrupt(\"return\", {\n              newReleases: newReleasesJson\n            });\n\n          case 17:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default Home;","map":{"version":3,"sources":["/Users/ivaroddsson/repos/discovered.is/ui/pages/index.js"],"names":["fetch","React","ReleaseList","Home","props","newReleases","token","getInitialProps","req","res","response","json","responseJSON","console","log","headers","Authorization","newReleasesJson","all","albums","items","map","item","artists","id","artistById","artistByIdJSON","genres"],"mappings":";;;;;AAAA,OAAOA,KAAP,MAAkB,oBAAlB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,WAAP,MAAwB,2BAAxB;;AAEA,IAAMC,IAAI,GAAG,SAAPA,IAAO,CAAAC,KAAK;AAAA,SAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,WAAD;AAAa,IAAA,QAAQ,EAAEA,KAAK,CAACC,WAA7B;AAA0C,IAAA,KAAK,EAAED,KAAK,CAACE,KAAvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF;AAAA;AAAA;AAAA,qsFADgB;AAAA,CAAlB;;AAOAH,IAAI,CAACI,eAAL;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAASC,YAAAA,GAAT,QAASA,GAAT,EAAcC,GAAd,QAAcA,GAAd;AAAA;AAAA,mBACET,KAAK,gDADP;;AAAA;AACfU,YAAAA,QADe;AAAA;AAAA,mBAEMA,QAAQ,CAACC,IAAT,EAFN;;AAAA;AAEfC,YAAAA,YAFe;AAGrBC,YAAAA,OAAO,CAACC,GAAR,CAAYF,YAAY,CAACN,KAAzB,EAHqB,CAIrB;;AAJqB;AAAA,mBAKKN,KAAK,8DAE7B;AACEe,cAAAA,OAAO,EAAE;AACPC,gBAAAA,aAAa,mBAAYJ,YAAY,CAACN,KAAzB,CADN;AAEP,+CAA+B,GAFxB;AAGP,gDAAgC;AAHzB,eADX;AAMEK,cAAAA,IAAI,EAAE;AANR,aAF6B,CALV;;AAAA;AAKfN,YAAAA,WALe;AAAA;AAAA,mBAkBSA,WAAW,CAACM,IAAZ,EAlBT;;AAAA;AAkBfM,YAAAA,eAlBe;AAAA;AAAA,mBAqBf,SAAQC,GAAR,CACJD,eAAe,CAACE,MAAhB,CAAuBC,KAAvB,CAA6BC,GAA7B;AAAA;AAAA;AAAA;AAAA;AAAA,uCAAiC,iBAAMC,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAENtB,KAAK,8CACUsB,IAAI,CAACC,OAAL,CAAa,CAAb,EAAgBC,EAD1B,GAE5B;AACET,0BAAAA,OAAO,EAAE;AACPC,4BAAAA,aAAa,mBAAYJ,YAAY,CAACN,KAAzB,CADN;AAEP,2DAA+B,GAFxB;AAGP,4DAAgC;AAHzB,2BADX;AAMEK,0BAAAA,IAAI,EAAE;AANR,yBAF4B,CAFC;;AAAA;AAEzBc,wBAAAA,UAFyB;AAAA;AAAA,+BAeFA,UAAU,CAACd,IAAX,EAfE;;AAAA;AAezBe,wBAAAA,cAfyB;AAgB/BJ,wBAAAA,IAAI,CAACK,MAAL,GAAcD,cAAc,CAACC,MAA7B;AAhB+B,yDAiBxBL,IAjBwB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAjC;;AAAA;AAAA;AAAA;AAAA,gBADI,CArBe;;AAAA;AAAA,8CA2Cd;AACLjB,cAAAA,WAAW,EAAEY;AADR,aA3Cc;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAvB;;AAAA;AAAA;AAAA;AAAA;;AAgDA,eAAed,IAAf","sourcesContent":["import fetch from \"isomorphic-unfetch\";\nimport React from \"react\";\nimport ReleaseList from \"../components/ReleaseList\";\n\nconst Home = props => (\n  <div>\n    <ReleaseList releases={props.newReleases} token={props.token} />\n    <style jsx>{``}</style>\n  </div>\n);\n\nHome.getInitialProps = async ({ req, res }) => {\n  const response = await fetch(`http://localhost:4000/server/routes/login.js`);\n  const responseJSON = await response.json();\n  console.log(responseJSON.token);\n  // Get new releases\n  const newReleases = await fetch(\n    `https://api.spotify.com/v1/browse/new-releases?country=SE`,\n    {\n      headers: {\n        Authorization: `Bearer ${responseJSON.token}`,\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n      },\n      json: true\n    }\n  );\n\n  // Convert newReleases to JSON\n  const newReleasesJson = await newReleases.json();\n\n  // For each new release, get the artist and append it's genre to it.\n  await Promise.all(\n    newReleasesJson.albums.items.map(async item => {\n      // Get artist by ID\n      const artistById = await fetch(\n        `https://api.spotify.com/v1/artists/${item.artists[0].id}`,\n        {\n          headers: {\n            Authorization: `Bearer ${responseJSON.token}`,\n            \"Access-Control-Allow-Origin\": \"*\",\n            \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n          },\n          json: true\n        }\n      );\n\n      // Convert artist to JSON\n      const artistByIdJSON = await artistById.json();\n      item.genres = artistByIdJSON.genres;\n      return item;\n    })\n  );\n\n  return {\n    newReleases: newReleasesJson\n  };\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}